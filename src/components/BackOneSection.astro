---
/* BackOneSection.astro */
---
<button id="backOneBtn" class="back-one" aria-label="Back to previous section" title="Up one section">↑</button>

<style>
  :root{
    --brand-600:#7A1919;
    --brand-700:#5E1111;
    --paper-0:#fff;
    --ink-900:#0B0B0B;
  }
  .back-one{
    position: fixed;
    right: clamp(12px, 2vw, 24px);
    bottom: clamp(16px, 3vw, 28px);
    z-index: 1000;
    width: 48px; height: 48px;
    border-radius: 999px;
    background: var(--paper-0);
    color: var(--ink-900);
    border: 2px solid var(--brand-600);
    box-shadow: 0 10px 28px rgba(0,0,0,.35);
    display: grid; place-items: center;
    cursor: pointer;
    opacity: 0; transform: translateY(8px);
    transition: opacity .2s ease, transform .2s ease, background .15s ease, color .15s ease, border-color .15s ease;
    pointer-events: none;
  }
  .back-one:hover{ background: var(--brand-600); color: var(--paper-0); border-color: var(--brand-700); }
  .back-one[data-show="1"]{ opacity:1; transform: translateY(0); pointer-events:auto; }

  @media (max-width:600px){
    .back-one{ width:56px; height:56px; }
  }
</style>

<script is:inline>
  (function(){
    const btn = document.getElementById('backOneBtn');
    if (!btn) return;

    // список секций только первого уровня внутри <main>
    const sections = Array.from(document.querySelectorAll('main > section'));
    if (sections.length < 2) { btn.remove(); return; }

    // показать кнопку, когда текущая секция по центру экрана имеет индекс >= 1
    const getCurrentIndex = () => {
      const centerY = window.scrollY + window.innerHeight / 2;
      let cur = 0;
      for (let i = 0; i < sections.length; i++){
        const s = sections[i];
        const top = s.offsetTop;
        const bottom = top + s.offsetHeight;
        if (centerY >= top && centerY < bottom) { cur = i; break; }
        if (centerY >= bottom) cur = i; // запас на больших экранax
      }
      return cur;
    };

    const refresh = () => {
      const idx = getCurrentIndex();
      btn.dataset.show = (idx >= 1) ? '1' : '0';
      btn.setAttribute('data-idx', String(idx));
    };

    let raf = 0;
    const onScroll = () => {
      if (raf) return;
      raf = requestAnimationFrame(() => { refresh(); raf = 0; });
    };
    document.addEventListener('scroll', onScroll, { passive:true });
    window.addEventListener('resize', refresh);
    refresh();

    btn.addEventListener('click', () => {
      const idx = +(btn.getAttribute('data-idx') || 0);
      const target = sections[Math.max(0, idx - 1)];
      if (target) target.scrollIntoView({ behavior:'smooth', block:'start' });
    });
  })();
</script>
